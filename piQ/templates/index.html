<!DOCTYPE html>
<html>
<head>
    <title> FyeFO (Sign-In)</title>
    <link rel="stylesheet" href="{{url_for('.static', filename='stylesheet.css')}}">
    <!--<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}">-->

    <!--<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>-->

</head>
<body onload="on_load()">
    <h1> FyeFo: The CS301 Help Desk Queue (Sign-In)</h1>
    <h2> Average wait time: {{wait}} min</h2>
    <div id = "form">
        <form id="myForm" action= "/" method="POST">
          Scan you Buzzcard or type your GTID (9-digit number) below! <input type="text" oninput="auto_submit()" name="gtid" id="gtid" autofocus>
          <input type="submit" name="add" value="Submit">



        </form>
        {% with messages = get_flashed_messages() %}
          {%if messages%}
            {% for message in messages %}
              <p>{{message}}</p>
            {% endfor %}
          {% endif %}
        {% endwith %}
    </div>

<div id="queue">
</div>

<div id="tas">
  <p> TAs on duty </p>
</div>

<script>
function auto_submit() {
  let x = document.getElementById("gtid").value;
  if (x.length == 9) {
    document.getElementById("myForm").submit();
  }

}
function on_load() {
  fetch("/queue").then(function(response) {
    return response.json()
  })
  .then(function(myJson) {
    load_queue(myJson["queue"], myJson["tas"]);
  });
}

function load_queue(queue, tas) {


  let queue_element = document.getElementById("queue");

  for (var i = 0; i < queue.length; i++) {
    let num = (i + 1).toString() + ". ";
    var para = document.createElement("p");
    var node = document.createTextNode(num + queue[i]);
    para.appendChild(node);
    queue_element.appendChild(para);
  }
  console.log(tas);
  let tas_element = document.getElementById("tas");
  var picdict = {"Jakob Brian Johnson":"jakob.png",
                  "Damian William Henry":"damian.png"}
  for (var i = 0; i < tas.length; i++) {
    // let num = (i + 1).toString() + ". ";
    var para = document.createElement("p");
    var node = document.createTextNode(tas[i]);
    var DOM_img = document.createElement("img");
    DOM_img.src = "static/"+ picdict[tas[i]]
    DOM_img.height = 150;
    DOM_img.width = 90;
    para.appendChild(node);
    para.appendChild(DOM_img);
    tas_element.appendChild(para);
  }



}
</script>

</body>
</html>
