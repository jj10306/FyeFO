<!DOCTYPE html>
<html>
<head>
    <title> FyeFO </title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="{{url_for('.static', filename='stylesheet.css')}}">

    <!--<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}">-->

    <!--<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>-->

</head>
<body onload="on_load()">
    <h1> FyeFo: The CS301 Help Desk Queue </h1>
    <h2> Average wait time: {{wait}} min</h2>
    <hr>
    <div id="tas">
      <h3> TAs on duty: </h3>
    </div>
    <hr>
    <div id = "ta-form">
        <form id="ta-myForm" action= "/" method="POST">
          <p> Hello {{name}}, what would you like to do? </p>
          <input type="submit" id="remove" name="remove" value="Remove next">
          <input type="submit" name="clear" value="Clear the queue" onclick="clearConfirm(event)">
          <input type="submit" id="signout" name="signout" value="Sign-Out" onclick="signOutConfirm(event)">
          <input type="submit" id="exit" name="exit" value="Exit">
        </form>
    </div>


    <h4> Queue: </h4>



<div id="queue">
  <div id="block1">
  <div>
  <div id="block2">
  <div>
  <div id="block3">
  <div>
  <div id="block4">
  <div>
  <div id="block5">
  <div>
</div>


<script>



function on_load() {
  fetch("/queue").then(function(response) {
    return response.json()
  })
  .then(function(myJson) {
    load_queue(myJson["queue"], myJson["tas"]);
  });
  //must pass function as function to be invoked (no parenthesis) otherwise, func will get called immediately
  //num seconds + 000 for the interval
  setTimeout(timeOut, 10000);
}
function timeOut() {
  document.getElementById("exit").click();
}

function load_queue(queue, tas) {


  let block_num = 0;
  //outer div id=queue"
  let container = document.getElementById("queue");
  for (var i = 0; i < queue.length; i++) {
    block_num = Math.floor(i / 5) + 1;
    let queue_element = document.getElementById("block" +  block_num.toString());
    let num = (i + 1).toString() + ". ";
    let para = document.createElement("p");
    let node = document.createTextNode(num + queue[i]);
    para.appendChild(node);
    queue_element.appendChild(para);
    //gives us the number for css id
    container.appendChild(queue_element);

  }











  let tas_element = document.getElementById("tas");
  var picdict = {"Jakob Brian Johnson":"jakob.png",
                  "Damian William Henry":"damian.png"}
  for (var i = 0; i < tas.length; i++) {
    // let num = (i + 1).toString() + ". ";
    let container = document.createElement("div");
    container.id = "ta" + (i + 1).toString();
    container.className = "ta-name";
    var para = document.createElement("p");
    var node = document.createTextNode(tas[i]);
    var br = document.createElement("br");

    var DOM_img = document.createElement("img");
    DOM_img.src = "static/"+ picdict[tas[i]]
    DOM_img.height = 150;
    DOM_img.width = 90;

    para.appendChild(node);

    container.appendChild(br);
    container.appendChild(DOM_img);
    container.appendChild(para);

    tas_element.appendChild(container);
  }



}

function clearConfirm(event) {
  if (!confirm("You are about to clear the ENTIRE queue, are you sure you want to do this?")) {
    event.preventDefault();
  }
}

function signOutConfirm(event) {
  if (!confirm("You are about to Sign-Out of FyeFo, are you sure you want to do this?")) {
    event.preventDefault();
  }
}

</script>

</body>
</html>
